#!/bin/bash

while ! psql -U stellar -h __DB_HOST__ -c 'select 1' core &> /dev/null ; do
  echo "Waiting for postgres to be available..."
  sleep 1
done

# there is a serious problem here
# where does this echo go to and also 
# stellar-core.cfg should be replaced by $CORE_CONFIG
echo "starting core..."
set -e
exec /usr/local/bin/stellar-core --conf "/opt/stellar/core/etc/__CORE_CONFIG__"
